<!DOCTYPE html>
<html lang="tr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TradePi Global</title>

    <!-- Vue 3 CDN -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>

    <!-- Supabase CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <link rel="stylesheet" href="/style.css" />
  </head>

  <body>
    <div id="app"></div>

    <!-- TradePi Uygulaması -->
    <script>
      const { createApp, ref, onMounted, computed } = Vue;

      const app = createApp({
        setup() {
          const supabase = window.supabase.createClient(
            "https://***.supabase.co",
            "***PUBLICKEY***"
          );

          const loadingPlans = ref(true);
          const plans = ref([]);
          const error = ref(null);

          // Planları çek
          const loadPlans = async () => {
            try {
              const { data, error: err } = await supabase
                .from("membership_plans")
                .select("*");

              if (err) throw err;
              plans.value = data || [];
            } catch (e) {
              console.error(e);
              error.value = "Planlar yüklenemedi.";
            } finally {
              loadingPlans.value = false;
            }
          };

          const formatPrice = (p) => Number(p).toLocaleString("tr-TR");

          const selectPlan = (plan) => {
            alert(`Paket seçildi: ${plan.name} — ${formatPrice(plan.price_monthly)} TL/ay`);
          };

          onMounted(() => loadPlans());

          return { loadingPlans, plans, error, selectPlan, formatPrice };
        },

        template: `
          <main class="container">

            <h2>Satıcı Üyelik Paketleri</h2>

            <div v-if="loadingPlans">Yükleniyor...</div>
            <div v-if="error">{{ error }}</div>

            <div v-else class="grid">
              <div v-for="p in plans" :key="p.id" class="card">
                <h3>{{ p.name }}</h3>
                <p>{{ p.description || 'Açıklama yok.' }}</p>
                <strong>{{ formatPrice(p.price_monthly) }} TL</strong>
                <button @click="selectPlan(p)">Seç</button>
              </div>
            </div>

          </main>
        `
      });

      app.mount("#app");
    </script> 
    <script type="module" src="/src/main.js"></script>
  </body>
</html>
